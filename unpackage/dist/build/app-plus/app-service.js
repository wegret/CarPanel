if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}let n=!1,o="60:E8:5B:6C:5C:8A",a="0000FFE0-0000-1000-8000-00805F9B34FB",c="0000FFE1-0000-1000-8000-00805F9B34FB";function l(e){return new Promise(((n,l)=>{let i=new Uint8Array([e]).buffer;!function e(s){uni.writeBLECharacteristicValue({deviceId:o,serviceId:a,characteristicId:c,value:i,success:function(e){n(e)},fail:function(n){s>0?e(s-1):(t("error","at services/BLE.js:122","Fail to send after retries!",n),l(n))}})}(3)}))}const i=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n};const s=i({components:{OutputStream:i({name:"OutputStream",props:{inputString:{type:Object,default:()=>({})}},data:()=>({LineText:[],scrollIntoViewId:"",showTimestamp:!1,checkboxes:[{value:"Stamp",name:"时间戳",checked:!1}]}),watch:{inputString:{immediate:!0,deep:!0,handler(e){if(e&&e.value){const t=(new Date).toLocaleTimeString();this.LineText.push({text:e.value,timestamp:t}),this.scrollIntoViewId="line"+(this.LineText.length-1)}}}},methods:{toggleTimestamp(){this.showTimestamp=!this.showTimestamp},checkboxChange:function(e){var t=e.detail.value;this.checkboxes.forEach((e=>{e.checked=t.includes(e.value)})),this.showTimestamp=this.checkboxes[0].checked}}},[["render",function(t,n,o,a,c,l){return e.openBlock(),e.createElementBlock(e.Fragment,null,[e.createElementVNode("checkbox-group",{onChange:n[0]||(n[0]=(...e)=>l.checkboxChange&&l.checkboxChange(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.checkboxes,(t=>(e.openBlock(),e.createElementBlock("label",{class:"switch",key:t.value},[e.createElementVNode("checkbox",{class:"toggle",value:t.value,checked:t.checked},null,8,["value","checked"]),e.createElementVNode("span",{class:e.normalizeClass(["slider",{"slider-checked":t.checked}])},null,2),e.createElementVNode("text",null,"时间戳")])))),128))],32),e.createElementVNode("view",{class:"container"},[e.createElementVNode("scroll-view",{"scroll-y":"",style:{height:"100px"},"scroll-into-view":c.scrollIntoViewId},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.LineText,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:n,id:"line"+n},[c.showTimestamp?(e.openBlock(),e.createElementBlock("span",{key:0,class:"timeStamp"},"("+e.toDisplayString(t.timestamp)+")",1)):e.createCommentVNode("",!0),e.createTextVNode(" "+e.toDisplayString(t.text),1)],8,["id"])))),128))],8,["scroll-into-view"])])],64)}],["__scopeId","data-v-2f23d25f"]])},data:()=>({title:"Panel",IndexIsConnected:!1,byteQueue:[],streamText:{value:""},states:[{id:"Angle",label:"Angle",type:"number",value:0,num:1,codetype:1}]}),onShow(){this.IndexIsConnected=n,t("log","at pages/index/index.vue:77","Connection State:",this.IndexIsConnected),this.IndexIsConnected&&t("log","at pages/index/index.vue:79","DeviceId:",o),uni.onBLEConnectionStateChange((e=>{e.connected||(t("log","at pages/index/index.vue:83","连接已断开"),this.IndexIsConnected=!1,uni.showToast({title:"蓝牙已断开！",icon:"fail",duration:2e3}))}))},onLoad(){uni.onBLECharacteristicValueChange((e=>{t("log","at pages/index/index.vue:96","Receive!"),this.extractBytesFromBuffer(e.value)}))},methods:{gotoBluetooth(){uni.navigateTo({url:"/pages/bluetooth/bluetooth"})},disconnectBluetooth(){this.IndexIsConnected=function(){if(!n)return t("log","at services/BLE.js:50","Bluetooth is not connected"),!1;uni.closeBLEConnection({deviceId:o,success:e=>(n=!1,t("log","at services/BLE.js:58","Disconnected successfully!"),uni.showToast({title:"蓝牙已断开连接！",icon:"success",duration:2e3}),!1),fail:e=>(t("error","at services/BLE.js:67","Failed to disconnect:",e),uni.showToast({title:"断开连接失败！",icon:"fail",duration:2e3}),n)})}()},gotoSetting(){uni.navigateTo({url:"/pages/setting/setting"})},gotoDebugger(){uni.navigateTo({url:"/pages/debugger/debugger"})},ListenerStart(){uni.notifyBLECharacteristicValueChange({deviceId:o,serviceId:a,characteristicId:c,state:!0,success:e=>{t("log","at services/BLE.js:87","Notification enabled for",c,":",e),uni.showToast({title:"蓝牙接收启动！",icon:"success",duration:2e3})},fail:e=>{uni.showToast({title:"启动失败！",icon:"fail",duration:2e3})}})},test(){!function(e){let n=new ArrayBuffer(e.length),l=new DataView(n);for(let t=0;t<e.length;t++)l.setUint8(t,e.charCodeAt(t));uni.writeBLECharacteristicValue({deviceId:o,serviceId:a,characteristicId:c,value:n,success:function(e){t("log","at services/BLE.js:147","Data sent successfully:",e),uni.showToast({title:"发送成功！",icon:"success",duration:2e3})},fail:function(e){t("error","at services/BLE.js:155","Failed to send data:",e),uni.showToast({title:"发送失败！",icon:"success",duration:2e3})}})}("Hello world!")},CarStart(){l(1),l(0)},CarStop(){l(2),l(0)},extractBytesFromBuffer(e){const t=new Uint8Array(e);for(let n=0;n<t.length;n++)0!=t[n]?this.byteQueue.push(t[n]):this.handleMessage()},getHex_value_2:(e,t)=>254*(e-1)+(t-1),handleMessage(){if(t("log","at pages/index/index.vue:159","Line",this.byteQueue),this.streamText={key:Date.now(),value:this.byteQueue.join(",")+";"},"0x02"==this.byteQueue[0]){let e=this.byteQueue[1],t=this.getHex_value_2(this.byteQueue[2],this.byteQueue[3]),n=this.states.find((t=>t.num===e));n&&(n.value=t)}this.byteQueue=[]}}},[["render",function(t,n,o,a,c,l){const i=e.resolveComponent("OutputStream");return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("view",null,[c.IndexIsConnected?(e.openBlock(),e.createElementBlock("button",{key:0,class:"button btn-connected",onClick:n[0]||(n[0]=(...e)=>l.disconnectBluetooth&&l.disconnectBluetooth(...e))},"蓝牙已链接")):(e.openBlock(),e.createElementBlock("button",{key:1,class:"button btn-unconnected",onClick:n[1]||(n[1]=(...e)=>l.gotoBluetooth&&l.gotoBluetooth(...e))},"蓝牙未链接"))]),c.IndexIsConnected?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("button",{onClick:n[2]||(n[2]=(...e)=>l.test&&l.test(...e))},"测试通信"),e.createElementVNode("button",{onClick:n[3]||(n[3]=(...e)=>l.ListenerStart&&l.ListenerStart(...e))},"开启接收")])):e.createCommentVNode("",!0),c.IndexIsConnected?(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("button",{onClick:n[4]||(n[4]=(...e)=>l.CarStart&&l.CarStart(...e)),class:"button btn-important"},"启动"),e.createElementVNode("button",{onClick:n[5]||(n[5]=(...e)=>l.CarStop&&l.CarStop(...e))},"停止")])):e.createCommentVNode("",!0),e.createElementVNode("view",null,[e.createElementVNode("button",{onClick:n[6]||(n[6]=(...e)=>l.gotoSetting&&l.gotoSetting(...e))},"设置参数")]),e.createElementVNode("view",null,[e.createElementVNode("button",{onClick:n[7]||(n[7]=(...e)=>l.gotoDebugger&&l.gotoDebugger(...e))},"调试模式")]),e.createVNode(i,{inputString:c.streamText},null,8,["inputString"]),c.IndexIsConnected?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:2},e.renderList(c.states,(t=>(e.openBlock(),e.createElementBlock("view",{class:"state-container"},[e.createElementVNode("text",{class:"state-text-title"},e.toDisplayString(t.label),1),e.createElementVNode("text",{class:"state-text-detail"},e.toDisplayString(t.value),1)])))),256)):e.createCommentVNode("",!0)])}]]);const r=i({data:()=>({devices:[]}),onLoad(){uni.openBluetoothAdapter({success:e=>{uni.startBluetoothDevicesDiscovery({success:e=>{this.addBluetoothDeviceListener()},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:50","Failed to Find Bluetooth",e),uni.showToast({title:"蓝牙启动失败！",icon:"fail",duration:2e3})}})},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:60","Failed to open Bluetooth",e),uni.showToast({title:"蓝牙启动失败！",icon:"fail",duration:2e3})}})},methods:{addBluetoothDeviceListener(){uni.getBluetoothAdapterState({success:e=>{},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:75","Bluetooth Adapter FAILED",e)}}),uni.onBluetoothDeviceFound((e=>{this.devices=[...this.devices,...e.devices]}))},selectDevice_Default(){uni.createBLEConnection({deviceId:o,success:e=>{n=!0,t("log","at services/BLE.js:27","Connect OK!"),uni.showToast({title:"蓝牙连接成功！",icon:"success",duration:2e3}),setTimeout((function(){uni.navigateBack()}),500)},fail:e=>{n=!1,uni.showToast({title:"蓝牙连接失败！",icon:"fail",duration:2e3})}})}}},[["render",function(t,n,o,a,c,l){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("text",null," 搜索设备中... "),e.createElementVNode("view",null,[e.createElementVNode("button",{onClick:n[0]||(n[0]=e=>l.selectDevice_Default()),class:"button-important"}," 链接默认设备 ")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.devices,(n=>(e.openBlock(),e.createElementBlock("view",{key:n.deviceId,onClick:e=>t.selectDevice(n),class:"device-box"},[e.createElementVNode("view",null,[e.createElementVNode("text",null,"设备名称： "+e.toDisplayString(n.name),1)]),e.createElementVNode("view",null,[e.createElementVNode("text",null,"设备ID： "+e.toDisplayString(n.deviceId),1)])],8,["onClick"])))),128))])}]]);const u=i({data:()=>({groups:[{groupName:"电机PID",params:[{id:"Kp",label:"Kp",type:"number",value:3.7,num:1,codetype:1},{id:"Ki",label:"Ki",type:"number",value:.05,num:2,codetype:1},{id:"Kd",label:"Kd",type:"number",value:0,num:3,codetype:1}]},{groupName:"速度参数",params:[{id:"v_straight",label:"左轮速度",type:"number",value:750,num:4,codetype:0},{id:"v_turning",label:"右轮速度",type:"number",value:750,num:5,codetype:0},{id:"v_turning_low",label:"弯道低速",type:"number",value:400,num:10,codetype:0},{id:"v_turning_high",label:"弯道高速",type:"number",value:1e3,num:11,codetype:0}]},{groupName:"舵机PID",params:[{id:"Kp_d",label:"Kp_d",type:"number",value:1.6,num:6,codetype:1},{id:"Ki_d",label:"Ki_d",type:"number",value:0,num:7,codetype:1},{id:"Kd_d",label:"Kd_d",type:"number",value:5,num:8,codetype:1}]},{groupName:"视觉参数",params:[{id:"MID_START",label:"中点预计点",type:"number",value:70,num:9,codetype:0}]}]}),onLoad(){},methods:{checkNumberType:e=>Number.isInteger(e)?1:0,async sendByteAsync(e){await new Promise((t=>{l(e),setTimeout(t,10)}))},async submitSingleParameter(e,n,o){if(await this.sendByteAsync(3),0==o)t("log","at pages/setting/setting.vue:158","整数"),await this.sendByteAsync(e),await this.sendByteAsync(n/254+1),await this.sendByteAsync(n%254+1),await this.sendByteAsync(0);else{t("log","at pages/setting/setting.vue:164","浮点数");let o=Math.round(100*n);await this.sendByteAsync(e),await this.sendByteAsync(o/254+1),await this.sendByteAsync(o%254+1),await this.sendByteAsync(0)}}}},[["render",function(t,n,o,a,c,l){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("view",{class:"title"},"参数设置"),(e.openBlock(),e.createBlock(e.KeepAlive,null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.groups,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.groupName,class:"group-container"},[e.createElementVNode("view",{class:"group-title"},e.toDisplayString(t.groupName),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.params,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"input-group"},[e.createElementVNode("text",{class:"label"},e.toDisplayString(t.label),1),e.withDirectives(e.createElementVNode("input",{type:t.type,"onUpdate:modelValue":e=>t.value=e,placeholder:"请输入"+t.label,class:"input",step:t.step||.01},null,8,["type","onUpdate:modelValue","placeholder","step"]),[[e.vModelDynamic,t.value,void 0,{number:!0}]]),e.createElementVNode("button",{onClick:e=>l.submitSingleParameter(t.num,t.value,t.codetype),class:"button btn-submit"},"提交",8,["onClick"])])))),128))])))),128))],1024))])}]]);const d=i({data:()=>({moduleBoxes:[{value:"Normal",name:"普通模式",checked:!0,code:1},{value:"Camera",name:"图传模式",checked:!1,code:2}],selectedModuleValue:"Normal",checkboxes_Normal:[{value:"NOR_DIFFSPEED_VIS",name:"是否开启差速",code:1,checked:!0},{value:"NOR_STATE_MONITOR",name:"是否开启状态监视",code:2,checked:!0}],checkboxes_Camera:[{value:"CAM_PC_VIS",name:"是否传图给上位机",code:1,checked:!0},{value:"CAM_TFT_VIS",name:"是否传图给TFT屏幕",code:2,checked:!1},{value:"CAM_SERVO_ON",name:"是否开启舵机测试方向",code:3,checked:!1}]}),methods:{onRadioChange:function(e){var n=e.detail.value;for(const t of this.moduleBoxes)t.checked=n.includes(t.value),t.checked&&(this.selectedModuleValue=t.value,this.chooseModule(t));t("log","at pages/debugger/debugger.vue:101",this.selectedModuleValue)},async sendByteAsync(e){await new Promise((t=>{l(e),setTimeout(t,10)}))},async chooseModule(e){await this.sendByteAsync(4),await this.sendByteAsync(e.code),await this.sendByteAsync(0)},async chooseDetail(e,t){await this.sendByteAsync(5),await this.sendByteAsync(e),await this.sendByteAsync(t+1),await this.sendByteAsync(0)},checkboxChange_Camera:function(e){var t=e.detail.value;this.checkboxes_Camera.forEach((e=>{e.checked!=t.includes(e.value)&&(e.checked=t.includes(e.value),this.chooseDetail(e.code,e.checked))}))},checkboxChange_Normal:function(e){var t=e.detail.value;this.checkboxes_Normal.forEach((e=>{e.checked!=t.includes(e.value)&&(e.checked=t.includes(e.value),this.chooseDetail(e.code,e.checked))}))}}},[["render",function(t,n,o,a,c,l){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("radio-group",{onChange:n[0]||(n[0]=(...e)=>l.onRadioChange&&l.onRadioChange(...e)),class:"radio-inputs"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.moduleBoxes,((t,n)=>(e.openBlock(),e.createElementBlock("view",{class:"radio-tile",key:n},[e.createElementVNode("radio",{class:"radio-input",value:t.value,checked:t.checked},e.toDisplayString(t.name),9,["value","checked"])])))),128))],32),"Normal"==c.selectedModuleValue?(e.openBlock(),e.createElementBlock("view",{key:0,class:"module-container"},[e.createElementVNode("text",{class:"text-log"},"已开启普通模式！"),e.createElementVNode("checkbox-group",{onChange:n[1]||(n[1]=(...e)=>l.checkboxChange_Normal&&l.checkboxChange_Normal(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.checkboxes_Normal,(t=>(e.openBlock(),e.createElementBlock("label",{key:t.value},[e.createElementVNode("checkbox",{value:t.value,checked:t.checked},e.toDisplayString(t.name),9,["value","checked"])])))),128))],32)])):e.createCommentVNode("",!0),"Camera"==c.selectedModuleValue?(e.openBlock(),e.createElementBlock("view",{key:1,class:"module-container"},[e.createElementVNode("text",{class:"text-log"},"已开启图传模式！"),e.createElementVNode("checkbox-group",{onChange:n[2]||(n[2]=(...e)=>l.checkboxChange_Camera&&l.checkboxChange_Camera(...e))},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(c.checkboxes_Camera,(t=>(e.openBlock(),e.createElementBlock("label",{key:t.value},[e.createElementVNode("checkbox",{value:t.value,checked:t.checked},e.toDisplayString(t.name),9,["value","checked"])])))),128))],32)])):e.createCommentVNode("",!0)])}]]);const h=i({data:()=>({waveInterval:50,formWidth:"",formHeight:"",waveData:[]}),onReady(){const e=uni.createCanvasContext("Waveform-canvas",this);let t=0;setInterval((()=>{e.clearRect(0,0,200,200),e.beginPath(),e.arc(100,100,50,0,2*Math.PI),e.setFillStyle("#66ccff"),e.fill(),e.closePath(),e.beginPath(),e.arc(100,100,50,0,t),e.setStrokeStyle("#ffcc00"),e.setLineWidth(5),e.stroke(),e.closePath(),e.draw(),t+=.1,t>=2*Math.PI&&(t=0)}),this.waveInterval)}},[["render",function(t,n,o,a,c,l){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("canvas",{class:"WaveCanvas-container","canvas-id":"Waveform-canvas",style:{width:"100%",height:"200px"}})])}]]);__definePage("pages/index/index",s),__definePage("pages/bluetooth/bluetooth",r),__definePage("pages/setting/setting",u),__definePage("pages/debugger/debugger",d),__definePage("pages/screen/screen",h);const m={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:p,Vuex:g,Pinia:v}={app:e.createVueApp(m)};uni.Vuex=g,uni.Pinia=v,p.provide("__globalStyles",__uniConfig.styles),p._component.mpType="app",p._component.render=()=>{},p.mount("#app")}(Vue);

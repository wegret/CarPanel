if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((i=>t.resolve(e()).then((()=>i))),(i=>t.resolve(e()).then((()=>{throw i}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...i){uni.__log__?uni.__log__(e,t,...i):console[e].apply(console,[...i,t])}function i(e,i,n,o){return new Promise(((a,r)=>{let l=new Uint8Array([o]).buffer;!function o(c){uni.writeBLECharacteristicValue({deviceId:e,serviceId:i,characteristicId:n,value:l,success:function(e){t("log","at services/BLE.js:13","Sent: ",e),a(e)},fail:function(e){c>0?(t("warn","at services/BLE.js:18","Send failed, retrying...",e),o(c-1)):(t("error","at services/BLE.js:21","Fail to send after retries!",e),r(e))}})}(3)}))}i(globalThis.deviceId,globalThis.serviceId,globalThis.characteristicId,1).then((()=>new Promise((e=>{setTimeout((()=>{e()}),100)})))).then((()=>i(globalThis.deviceId,globalThis.serviceId,globalThis.characteristicId,0))).catch((e=>t("error","at services/BLE.js:42","Error sending bytes:",e)));const n=(e,t)=>{const i=e.__vccOpts||e;for(const[n,o]of t)i[n]=o;return i};const o=n({data:()=>({title:"Panel",isConnected:!1,isStarted:!1,deviceId:"60:E8:5B:6C:5C:8A",serviceId:"0000FFE0-0000-1000-8000-00805F9B34FB",characteristicId:"0000FFE1-0000-1000-8000-00805F9B34FB"}),onShow(){t("log","at pages/index/index.vue:39","State:",this.isConnected),t("log","at pages/index/index.vue:40","DeviceId:",this.deviceId)},onLoad(){uni.onBLECharacteristicValueChange((e=>{t("log","at pages/index/index.vue:45","Received data:",new Uint8Array(e.value))}))},methods:{gotoBluetooth(){uni.navigateTo({url:"/pages/bluetooth/bluetooth"})},gotoSetting(){uni.navigateTo({url:"/pages/setting/setting"})},enableBluetoothListener(e,i){uni.notifyBLECharacteristicValueChange({deviceId:this.deviceId,serviceId:e,characteristicId:i,state:!0,success:e=>{t("log","at pages/index/index.vue:66","Notification enabled for",i,":",e)}})},test(){let e=new ArrayBuffer("hello world".length),i=new DataView(e);for(let t=0;t<"hello world".length;t++)i.setUint8(t,"hello world".charCodeAt(t));uni.writeBLECharacteristicValue({deviceId:this.deviceId,serviceId:"0000FFE0-0000-1000-8000-00805F9B34FB",characteristicId:"0000FFE1-0000-1000-8000-00805F9B34FB",value:e,success:function(e){t("log","at pages/index/index.vue:135","Data sent successfully:",e)},fail:function(e){t("error","at pages/index/index.vue:138","Failed to send data:",e)}}),this.enableBluetoothListener("0000FFE0-0000-1000-8000-00805F9B34FB","0000FFE1-0000-1000-8000-00805F9B34FB")},CarStart(){i(this.deviceId,this.serviceId,this.characteristicId,1),i(this.deviceId,this.serviceId,this.characteristicId,0)},CarStop(){i(this.deviceId,this.serviceId,this.characteristicId,2),i(this.deviceId,this.serviceId,this.characteristicId,0)}}},[["render",function(t,i,n,o,a,r){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("view",null,[e.createElementVNode("button",{onClick:i[0]||(i[0]=(...e)=>r.gotoBluetooth&&r.gotoBluetooth(...e))},e.toDisplayString(a.isConnected?"蓝牙已链接":"蓝牙未链接"),1)]),a.isConnected?(e.openBlock(),e.createElementBlock("view",{key:0},[e.createElementVNode("button",{onClick:i[1]||(i[1]=(...e)=>r.test&&r.test(...e))},"测试通信"),e.createElementVNode("button",{onClick:i[2]||(i[2]=(...e)=>r.CarStart&&r.CarStart(...e)),class:"button-important"},"启动"),e.createElementVNode("button",{onClick:i[3]||(i[3]=(...e)=>r.CarStop&&r.CarStop(...e))},"停止")])):e.createCommentVNode("",!0),a.isConnected?(e.openBlock(),e.createElementBlock("view",{key:1},[e.createElementVNode("button",{onClick:i[4]||(i[4]=(...e)=>r.gotoSetting&&r.gotoSetting(...e))},"设置参数")])):e.createCommentVNode("",!0)])}]]);const a=n({data:()=>({devices:[]}),onLoad(){uni.openBluetoothAdapter({success:e=>{uni.startBluetoothDevicesDiscovery({success:e=>{this.addBluetoothDeviceListener()},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:44","Failed to Find Bluetooth",e),uni.showToast({title:"蓝牙启动失败！",icon:"fail",duration:2e3})}})},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:54","Failed to open Bluetooth",e),uni.showToast({title:"蓝牙启动失败！",icon:"fail",duration:2e3})}})},methods:{addBluetoothDeviceListener(){uni.getBluetoothAdapterState({success:e=>{},fail:e=>{t("error","at pages/bluetooth/bluetooth.vue:71","Bluetooth Adapter FAILED",e)}}),uni.onBluetoothDeviceFound((e=>{this.devices=[...this.devices,...e.devices]}))},selectDevice(e){const i=getCurrentPages()[0];uni.createBLEConnection({deviceId:e.deviceId,success:e=>{i.isConnected=!0,t("log","at pages/bluetooth/bluetooth.vue:92","Connect OK!"),uni.showToast({title:"蓝牙连接成功！",icon:"success",duration:2e3}),setTimeout((function(){uni.navigateBack()}),500)},fail:e=>{uni.showToast({title:"蓝牙连接失败！",icon:"fail",duration:2e3})}})},selectDevice_Default(){const e=getCurrentPages(),i=e[0];uni.createBLEConnection({deviceId:e[0].deviceId,success:e=>{i.isConnected=!0,t("log","at pages/bluetooth/bluetooth.vue:122","Connect OK!"),uni.showToast({title:"蓝牙连接成功！",icon:"success",duration:2e3}),setTimeout((function(){uni.navigateBack()}),500)},fail:e=>{uni.showToast({title:"蓝牙连接失败！",icon:"fail",duration:2e3})}})}}},[["render",function(t,i,n,o,a,r){return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("text",null," 搜索设备中... "),e.createElementVNode("view",null,[e.createElementVNode("button",{onClick:i[0]||(i[0]=e=>r.selectDevice_Default()),class:"button-important"}," 链接默认设备 ")]),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.devices,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.deviceId,onClick:e=>r.selectDevice(t),class:"device-box"},[e.createElementVNode("view",null,[e.createElementVNode("text",null,"设备名称： "+e.toDisplayString(t.name),1)]),e.createElementVNode("view",null,[e.createElementVNode("text",null,"设备ID： "+e.toDisplayString(t.deviceId),1)])],8,["onClick"])))),128))])}]]);const r=n({data:()=>({groups:[{groupName:"左轮PID",params:[{id:"Kp",label:"Kp",type:"number",value:0},{id:"Ki",label:"Ki",type:"number",value:0},{id:"Kd",label:"Kd",type:"number",value:0}]},{groupName:"右轮PID",params:[{id:"Kp",label:"Kp",type:"number",value:0},{id:"Ki",label:"Ki",type:"number",value:0},{id:"Kd",label:"Kd",type:"number",value:0}]},{groupName:"速度参数",params:[{id:"v_straight",label:"直道速度",type:"number",value:0},{id:"v_turning",label:"弯道速度",type:"number",value:0}]}]}),methods:{}},[["render",function(t,i,n,o,a,r){return e.openBlock(),e.createElementBlock("view",{class:"content"},[e.createElementVNode("view",{class:"title"},"参数设置"),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.groups,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.groupName,class:"group-container"},[e.createElementVNode("view",{class:"group-title"},e.toDisplayString(t.groupName),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.params,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"input-group"},[e.createElementVNode("text",{class:"label"},e.toDisplayString(t.label),1),e.withDirectives(e.createElementVNode("input",{type:t.type,"onUpdate:modelValue":e=>t.value=e,placeholder:"请输入"+t.label,class:"input",step:t.step||.01},null,8,["type","onUpdate:modelValue","placeholder","step"]),[[e.vModelDynamic,t.value,void 0,{number:!0}]])])))),128))])))),128)),e.createElementVNode("button",{onClick:i[0]||(i[0]=(...e)=>t.submitParameters&&t.submitParameters(...e)),class:"submit-btn"},"提交")])}]]);__definePage("pages/index/index",o),__definePage("pages/bluetooth/bluetooth",a),__definePage("pages/setting/setting",r);const l={onLaunch:function(){t("log","at App.vue:4","App Launch")},onShow:function(){t("log","at App.vue:7","App Show")},onHide:function(){t("log","at App.vue:10","App Hide")}};const{app:c,Vuex:s,Pinia:u}={app:e.createVueApp(l)};uni.Vuex=s,uni.Pinia=u,c.provide("__globalStyles",__uniConfig.styles),c._component.mpType="app",c._component.render=()=>{},c.mount("#app")}(Vue);
